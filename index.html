<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Pruebas de API Buscar Personas</title>
    <style>
        h2 {
            color: #8BC34A;
            background-color: #50614f;
            padding: 10px;
            text-align: center;
        }

        table {
            width: 100%;
            margin-top: 10px;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid darkgreen;
            padding: 10px;
            text-align: left;
        }

        th {
            background: #8BC34A;
        }

        #thnombres {
            width: 350px;
        }

        input {
            font-size: 15px;
            color: #4CAF50;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h2>Buscar Personas</h2>

    <input id="txtBusqueda" type="text" placeholder="Ingrese nombre o identificaci√≥n">
    <input type="button" value="Buscar üîé" onclick="Buscar()">
    <input type="button" value="Limpiar üóëÔ∏è" onclick="Limpiar()">
    
    <table id="tbResultado">
        <thead>
            <tr>
                <th>Identificaci√≥n</th>
                <th id="thnombres">Nombre Completo</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function Limpiar() {
            document.getElementById('txtBusqueda').value = "";
            document.querySelector("#tbResultado tbody").innerHTML = "";
        }

        async function Buscar() {
            let valorBuscar = document.getElementById('txtBusqueda').value.trim();
            if (valorBuscar.length < 1) return;

            let requestData = {
                identificacion: valorBuscar,
                primernombre: "",
                segundonombre: "",
                primerapellido: "",
                segundoapellido: ""
            };

            try {
                let response = await $.ajax({
                    url: "https://portalapi.minsa.gob.ni/wsconsultasipai/v1/consulta/info/obtenerDatosPersonaVacuna",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(requestData),
                });

                let data = JSON.parse(JSON.parse(response).Data);
                let tbody = document.querySelector("#tbResultado tbody");
                tbody.innerHTML = ""; // Limpia resultados previos

                if (!data.persona || data.persona.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="2">No hay datos compatibles con la b√∫squeda.</td></tr>`;
                    return;
                }

                data.persona.forEach(persona => {
                    let fila = `<tr>
                                    <td>${persona.CodigoIdentificacion || "N/A"}</td>
                                    <td>${persona.NombreCompleto || "N/A"}</td>
                                </tr>`;
                    tbody.innerHTML += fila;
                });

            } catch (error) {
                console.error("Error en la b√∫squeda:", error);
                alert("Error al buscar datos. Int√©ntelo de nuevo.");
            }
        }
    </script>
</body>
</html>
